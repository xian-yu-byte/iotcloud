<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.cloud.iotcloudspring.mapper.DeviceMapper">
    <insert id="insertDeviceType" parameterType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceType">
        INSERT INTO devicetype
        (projectid, typename, accesscategory, communicationmode, protocol, dataformat, createtime, updatetime)
        VALUES (#{projectid}, #{typename}, #{accesscategory}, #{communicationmode}, #{protocol}, #{dataformat}, NOW(),
                NOW())
    </insert>

    <delete id="deleteDeviceType" parameterType="java.lang.Long">
        DELETE FROM devicetype WHERE id = #{id}
    </delete>

    <select id="selectDeviceTypeList" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceType">
        select id, typename, accesscategory, protocol
        from devicetype
        where projectid = #{projectid}
    </select>

    <select id="selectDeviceTypeNameList" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceType">
        select id, typename
        from devicetype
        where projectid = #{projectid}
    </select>

    <insert id="insertDeviceTypeAttribute" parameterType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceTypeAttribute">
        INSERT INTO devicetypeattribute (devicetypeid, attributename, displayname,
                                         fieldkey,
                                         iscontrol,
                                         isquery, attributeunit, datatype,
                                         devicetypeattribute.attributetype, attributedesc, expandoptions, createtime,
                                         updatetime)
        VALUES (#{devicetypeid}, #{attributename}, #{displayname},
                #{fieldkey},
                #{iscontrol},
                #{isquery}, #{attributeunit}, #{datatype}, #{attributetype}, #{attributedesc},
                #{expandoptions},
                NOW(), NOW())
    </insert>

    <select id="selectAttributesByDeviceTypeId" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceTypeAttribute">
        SELECT id,
               devicetypeid,
               attributename,
               attributeunit,
               datatype,
               attributetype,
               attributedesc,
               expandoptions
        FROM devicetypeattribute
        WHERE devicetypeid = #{devicetypeid}
    </select>

    <delete id="deleteDeviceTypeAttributeById" parameterType="java.lang.Long">
        DELETE FROM devicetypeattribute WHERE id = #{id}
    </delete>

    <insert id="insertDevice" parameterType="com.atguigu.cloud.iotcloudspring.pojo.device.Device">
        INSERT INTO device (projectid, devicetypeid, devicename, devicekey, devicecommunication, deviceinformation,
                            createtime, updatetime)
        VALUES (#{projectid}, #{devicetypeid}, #{devicename}, #{devicekey}, #{devicecommunication},
                #{deviceinformation}, NOW(), NOW())
    </insert>

    <select id="selectDeviceNameById" resultType="java.lang.String">
        SELECT devicename
        from device
        where id = #{id}
    </select>

    <delete id="deleteDeviceById" parameterType="java.lang.Long">
        delete
        from device
        where id = #{id}
    </delete>

    <select id="selectDeviceById" parameterType="Long" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.Device">
        SELECT id,
               projectid,
               devicetypeid,
               devicename,
               devicekey,
               devicecommunication,
               deviceinformation,
               createtime,
               updatetime
        FROM device
        WHERE id = #{id}
    </select>

    <select id="selectByTypeAndName" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceTypeAttribute">
        SELECT dta.*
        FROM device d
                 JOIN devicetypeattribute dta ON d.devicetypeid = dta.devicetypeid
        WHERE d.id = #{deviceid}
          AND dta.attributename = #{attributename}
    </select>

    <select id="selectDeviceTypeById" parameterType="java.lang.Long" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceType">
        SELECT
            id,
            projectid,
            typename,
            accesscategory,
            communicationmode,
            protocol,
            dataformat,
            createtime,
            updatetime
        FROM devicetype
        WHERE id = #{id}
    </select>

    <select id="selectDeviceDataByDeviceId" parameterType="java.lang.Long" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.DeviceData">
        SELECT
            id,
            deviceid,
            devicetypeattributeid,
            datakey,
            datavalue,
            timestamp
        FROM devicedata
        WHERE deviceid = #{deviceid}
    </select>

    <select id="selectDevicesByProjectId" parameterType="java.lang.Long" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.Device">
        SELECT
            id,
            projectid,
            devicetypeid,
            devicename,
            devicekey,
            createtime,
            updatetime
        FROM device
        WHERE projectid = #{projectid}
    </select>

    <select id="selectDeviceByDeviceTypeId" resultType="com.atguigu.cloud.iotcloudspring.pojo.device.Device">
        SELECT
            id,
            devicename,
            devicestatus,
            updatetime
        FROM device
        WHERE devicetypeid = #{devicetypeid}
    </select>

    <select id="selectDeviceTypeNameById" resultType="java.lang.String">
        select typename
        from devicetype
        where id = #{id}
    </select>

</mapper>